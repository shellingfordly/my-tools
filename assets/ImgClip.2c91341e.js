import{B as j}from"./index.cdfcc5d8.js";import{S as G}from"./index.faf6bb44.js";import{s as K}from"./selectFile.a2607bdd.js";import{a as q}from"./getVideoInfo.ecd0ef5d.js";import{I as n,s as J,t as A,a5 as Z,a6 as ee,a7 as te,r as y,c as N,y as L,j as E,V as R,v as re,d as X,o as w,a as x,f as v,i as ne,_ as se,a0 as oe,a1 as ae,B as b,w as C,E as T,F as le}from"./index.4b01108f.js";import"./handleFile.719ba7a4.js";const ie=({width:r,height:t,img:e,pos:s})=>{const o=document.createElement("canvas"),l=o.getContext("2d");o.width=r,o.height=t,l.save(),l.translate(r/2,t/2),l.translate(-r/2,-t/2),l.drawImage(e,0,0,r,t),l.restore();const c=s.w,a=s.h;if(!c||!a)return"";const i=l.getImageData(s.x,s.y,c,a);return o.width=c,o.height=a,l.putImageData(i,0,0),new Promise(d=>{o.toBlob(u=>d(u))})};var B;const I=typeof window!="undefined",ce=r=>typeof r=="string",ue=()=>{};I&&((B=window==null?void 0:window.navigator)==null?void 0:B.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function O(r){return typeof r=="function"?r():n(r)}function fe(r){return r}function pe(r){return ee()?(te(r),!0):!1}var de=Object.defineProperty,ve=Object.defineProperties,_e=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertySymbols,ye=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable,F=(r,t,e)=>t in r?de(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,ge=(r,t)=>{for(var e in t||(t={}))ye.call(t,e)&&F(r,e,t[e]);if(U)for(var e of U(t))he.call(t,e)&&F(r,e,t[e]);return r},me=(r,t)=>ve(r,_e(t));function we(r){if(!J(r))return A(r);const t=Array.isArray(r.value)?new Array(r.value.length):{};for(const e in r.value)t[e]=Z(()=>({get(){return r.value[e]},set(s){if(Array.isArray(r.value)){const o=[...r.value];o[e]=s,r.value=o}else{const o=me(ge({},r.value),{[e]:s});Object.setPrototypeOf(o,r.value),r.value=o}}}));return t}function Y(r){var t;const e=O(r);return(t=e==null?void 0:e.$el)!=null?t:e}const k=I?window:void 0;I&&window.document;I&&window.navigator;I&&window.location;function m(...r){let t,e,s,o;if(ce(r[0])||Array.isArray(r[0])?([e,s,o]=r,t=k):[t,e,s,o]=r,!t)return ue;Array.isArray(e)||(e=[e]),Array.isArray(s)||(s=[s]);const l=[],c=()=>{l.forEach(u=>u()),l.length=0},a=(u,g,_,h)=>(u.addEventListener(g,_,h),()=>u.removeEventListener(g,_,h)),i=L(()=>[Y(t),O(o)],([u,g])=>{c(),u&&l.push(...e.flatMap(_=>s.map(h=>a(u,_,h,g))))},{immediate:!0,flush:"post"}),d=()=>{i(),c()};return pe(d),d}const $=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},S="__vueuse_ssr_handlers__";$[S]=$[S]||{};$[S];var xe=Object.defineProperty,Oe=Object.defineProperties,Pe=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertySymbols,Ie=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable,Q=(r,t,e)=>t in r?xe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Ee=(r,t)=>{for(var e in t||(t={}))Ie.call(t,e)&&Q(r,e,t[e]);if(V)for(var e of V(t))be.call(t,e)&&Q(r,e,t[e]);return r},Ce=(r,t)=>Oe(r,Pe(t));function $e(r,t={}){var e,s,o;const l=(e=t.draggingElement)!=null?e:k,c=(s=t.handle)!=null?s:r,a=y((o=O(t.initialValue))!=null?o:{x:0,y:0}),i=y(),d=f=>t.pointerTypes?t.pointerTypes.includes(f.pointerType):!0,u=f=>{O(t.preventDefault)&&f.preventDefault(),O(t.stopPropagation)&&f.stopPropagation()},g=f=>{var p;if(!d(f)||O(t.exact)&&f.target!==O(r))return;const P=O(r).getBoundingClientRect(),D={x:f.clientX-P.left,y:f.clientY-P.top};((p=t.onStart)==null?void 0:p.call(t,D,f))!==!1&&(i.value=D,u(f))},_=f=>{var p;!d(f)||!i.value||(a.value={x:f.clientX-i.value.x,y:f.clientY-i.value.y},(p=t.onMove)==null||p.call(t,a.value,f),u(f))},h=f=>{var p;!d(f)||!i.value||(i.value=void 0,(p=t.onEnd)==null||p.call(t,a.value,f),u(f))};return I&&(m(c,"pointerdown",g,!0),m(l,"pointermove",_,!0),m(l,"pointerup",h,!0)),Ce(Ee({},we(a)),{position:a,isDragging:N(()=>!!i.value),style:N(()=>`left:${a.value.x}px;top:${a.value.y}px;`)})}function Se(r={}){const{type:t="page",touch:e=!0,resetOnTouchEnds:s=!1,initialValue:o={x:0,y:0},window:l=k,eventFilter:c}=r,a=y(o.x),i=y(o.y),d=y(null),u=p=>{t==="page"?(a.value=p.pageX,i.value=p.pageY):t==="client"?(a.value=p.clientX,i.value=p.clientY):t==="movement"&&(a.value=p.movementX,i.value=p.movementY),d.value="mouse"},g=()=>{a.value=o.x,i.value=o.y},_=p=>{if(p.touches.length>0){const P=p.touches[0];t==="page"?(a.value=P.pageX,i.value=P.pageY):t==="client"&&(a.value=P.clientX,i.value=P.clientY),d.value="touch"}},h=p=>c===void 0?u(p):c(()=>u(p),{}),f=p=>c===void 0?_(p):c(()=>_(p),{});return l&&(m(l,"mousemove",h,{passive:!0}),m(l,"dragover",h,{passive:!0}),e&&t!=="movement"&&(m(l,"touchstart",f,{passive:!0}),m(l,"touchmove",f,{passive:!0}),s&&m(l,"touchend",g,{passive:!0}))),{x:a,y:i,sourceType:d}}var H;(function(r){r.UP="UP",r.RIGHT="RIGHT",r.DOWN="DOWN",r.LEFT="LEFT",r.NONE="NONE"})(H||(H={}));var Ae=Object.defineProperty,W=Object.getOwnPropertySymbols,ke=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable,z=(r,t,e)=>t in r?Ae(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Ne=(r,t)=>{for(var e in t||(t={}))ke.call(t,e)&&z(r,e,t[e]);if(W)for(var e of W(t))De.call(t,e)&&z(r,e,t[e]);return r};const Te={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};Ne({linear:fe},Te);function Be(r,t,e){const s=E({x:0,y:0});return e&&(s.x=n(e).x,s.y=n(e).y),$e(t,{initialValue:n(s),onMove(o){var c;const l=(c=n(r))==null?void 0:c.getBoundingClientRect();s.x=o.x-l.left,s.y=o.y-l.top}}),{...A(s),position:s}}function Ue(r,t){const{x:e,y:s}=Se(),o=y(!1),l=E({x:0,y:0}),c=E({...n(t)}),a=n(t),i=[];R(()=>{o.value&&(c.w=a.w+e.value-l.x,c.h=a.h+s.value-l.y)});const d=L(()=>Y(r),_=>{u(),_&&g()}),u=()=>{i.forEach(_=>_()),i.length=0},g=()=>{const _=m(r,"mousedown",()=>{o.value=!0,l.x=e.value,l.y=s.value}),h=m(document,"mouseup",()=>{o.value=!1,a.w=c.w,a.h=c.h});i.push(_,h)};return re(()=>{u(),d()}),{...A(c),rect:c}}const M=r=>(oe("data-v-aad02df8"),r=r(),ae(),r),Fe={relative:"","w-full":"","h-500px":"","overflow-hidden":""},Ve=["src"],Qe={"w-full":"","h-full":"",absolute:"","overflow-visible":"","z-2":""},He={id:"svgMask"},We=M(()=>v("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"white"},null,-1)),ze=["x","y","width","height"],Le=M(()=>v("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"rgba(0,0,0,0.7)",mask:"url(#svgMask)"},null,-1)),Re=["x","y","width","height"],Xe={"overflow-visible":"","cursor-nwse-resize":"",class:"handle"},Ye=["cx","cy"],Me=["cx","cy"],je={"overflow-visible":"","cursor-nesw-resize":"",class:"handle"},Ge=["cx","cy"],Ke=["cx","cy"],qe={"overflow-visible":"","cursor-nesw-resize":"",class:"tr handle"},Je=["cx","cy"],Ze=["cx","cy"],et={"overflow-visible":"","cursor-nwse-resize":"",class:"tr handle"},tt=["cx","cy"],rt=["cx","cy"],nt=X({__name:"ClipSelect",props:{imgUrl:{}},emits:["change"],setup(r,{emit:t}){const e=E({x:50,y:50,w:200,h:200}),s=y(),o=y(),l=y(),{x:c,y:a}=Be(s,o,{x:e.x,y:e.y}),{rect:i}=Ue(l,{w:e.w,h:e.h});return R(()=>{e.x=c.value,e.y=a.value,e.w=i.w,e.h=i.h,t("change",{...e})}),(d,u)=>(w(),x("div",Fe,[v("div",{ref_key:"containerRef",ref:s,"w-full":"","h-full":"",absolute:"","overflow-visible":"",flex:"","items-center":"","justify-center":""},[d.imgUrl?(w(),x("img",{key:0,class:"img",src:d.imgUrl,filter:"url(#myFilter)",mask:"url(#svgClipPath)"},null,8,Ve)):ne("",!0)],512),v("div",Qe,[(w(),x("svg",{ref_key:"containerRef",ref:s,"overflow-visible":"","cursor-pointer":"",height:"100%",width:"100%"},[v("defs",null,[v("mask",He,[We,v("rect",{x:n(e).x,y:n(e).y,width:n(e).w,height:n(e).h,fill:"black"},null,8,ze)])]),Le,v("rect",{ref_key:"targetRef",ref:o,class:"main","cursor-move":"",x:n(e).x,y:n(e).y,width:n(e).w,height:n(e).h},null,8,Re),v("g",{ref_key:"scaleRef",ref:l},[(w(),x("svg",Xe,[v("circle",{cx:n(e).x,cy:n(e).y,r:"6","cursor-nwse-resize":"",fill:"rgb(255, 255, 255)"},null,8,Ye),v("circle",{cx:n(e).x,cy:n(e).y,r:"6",fill:"rgb(255, 255, 255)","cursor-nwse-resize":""},null,8,Me)])),(w(),x("svg",je,[v("circle",{cx:n(e).x+n(e).w,cy:n(e).y,r:"6",fill:"rgb(255, 255, 255)"},null,8,Ge),v("circle",{cx:n(e).x+n(e).w,cy:n(e).y,r:"6",fill:"rgb(255, 255, 255)"},null,8,Ke)])),(w(),x("svg",qe,[v("circle",{cx:n(e).x,cy:n(e).y+n(e).h,r:"6",fill:"rgb(255, 255, 255)"},null,8,Je),v("circle",{cx:n(e).x,cy:n(e).y+n(e).h,r:"6",fill:"rgb(255, 255, 255)"},null,8,Ze)])),(w(),x("svg",et,[v("circle",{cx:n(e).x+n(e).w,cy:n(e).y+n(e).h,r:"6",fill:"rgb(255, 255, 255)"},null,8,tt),v("circle",{cx:n(e).x+n(e).w,cy:n(e).y+n(e).h,r:"6",fill:"rgb(255, 255, 255)"},null,8,rt)]))],512)],512))])]))}});var st=se(nt,[["__scopeId","data-v-aad02df8"]]);const ot={flex:""},at={"w-400":"","p-20":""},lt=["src"],vt=X({__name:"ImgClip",setup(r){const t=y({}),e=y(),s=y("");async function o(){const c=await K("image"),a=await q(c);t.value=a}const l=()=>{const{url:c,width:a,height:i}=n(t),d=new Image;d.src=c,d.onload=async()=>{const u=await ie({width:a,height:i,img:d,pos:n(e)});s.value=window.URL.createObjectURL(u)}};return(c,a)=>{const i=j,d=G;return w(),x(le,null,[b(d,{"mb-20":""},{default:C(()=>[b(i,{onClick:o},{default:C(()=>[T("\u4E0A\u4F20\u56FE\u7247")]),_:1}),b(i,{onClick:l},{default:C(()=>[T("\u88C1\u526A")]),_:1})]),_:1}),v("div",ot,[b(st,{"flex-1":"","img-url":n(t).url,onChange:a[0]||(a[0]=u=>e.value=u)},null,8,["img-url"]),v("div",at,[v("img",{src:n(s),alt:""},null,8,lt)])])],64)}}});export{vt as default};
